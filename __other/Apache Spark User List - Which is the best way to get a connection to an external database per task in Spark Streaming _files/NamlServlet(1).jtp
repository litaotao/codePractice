var Nabble = new Object(); Nabble.main = 1; Nabble.getParent = function() { if (typeof(customParent) != 'undefined') return customParent(); try { if (parent.Nabble.main == 1) return parent.parent; } catch(err) {} return parent; }; if (!Array.prototype.indexOf) { Array.prototype.indexOf = function(e, start) { start = start || 0; if (start < 0) start += this.length; for (var i=start; i<this.length; i++) if (this[i] == e) return i; return -1; }; } Nabble.get = function(id) { return document.getElementById(id); }; Nabble.loadScript = function(url) { var e = document.createElement("script"); e.src = url; e.type="text/javascript"; document.getElementsByTagName("head")[0].appendChild(e); }; Nabble.escapeHTML = function(str) { var div = document.createElement('div'); var text = document.createTextNode(str); div.appendChild(text); return div.innerHTML; }; Nabble.escape = function(value) { if (typeof value == 'string') { var hasSpace = value.indexOf(' ') >= 0; var hasQuote = value.indexOf('"') >= 0; value = value.replace(/\;/g, '%3B'); value = value.replace(/"/g, '\\"'); if (hasSpace || hasQuote) value = '"' + value + '"'; } return value; }; Nabble.unescape = function(value) { if (value.charAt(0) == '"' && value.charAt(value.length-1) == '"') value = value.substring(1, value.length-1); value = value.replace(/\\"/g, '"'); value = value.replace(/%3B/g, ';'); return value; }; Nabble.getCookie = function(name) { if (Nabble.getParent().nabbleinfo) { try { return Nabble.getParent().nabbleinfo.getCookie(name); } catch (err) {} } var dc = document.cookie; var prefix = name + "="; var begin = dc.indexOf("; " + prefix); if (begin == -1) { begin = dc.indexOf(prefix); if (begin != 0) return null; } else begin += 2; var end = document.cookie.indexOf(";", begin); if (end == -1) end = dc.length; return Nabble.unescape(dc.substring(begin + prefix.length, end)); }; Nabble.setCookie = function(name, value) { if (Nabble.getParent().nabbleinfo) { try { return Nabble.getParent().nabbleinfo.setCookie(name,value); } catch (err) {} } var curCookie = name + "=" + Nabble.escape(value) + ";path=/"; document.cookie = curCookie; }; Nabble.setPersistentCookie = function(name, value) { if (Nabble.getParent().nabbleinfo) { try { return Nabble.getParent().nabbleinfo.setPersistentCookie(name, value); } catch (err) {} } var expires = new Date(); expires.setFullYear(expires.getFullYear()+10); var curCookie = name + "=" + Nabble.escape(value) + "; expires=" + expires.toGMTString() + "; path=/"; document.cookie = curCookie; }; Nabble.deleteCookie = function(name) { if (Nabble.getParent().nabbleinfo) { try { return Nabble.getParent().nabbleinfo.deleteCookie(name); } catch (err) {} } if (this.getCookie(name)) { document.cookie = name + "=" + "; path=/" + "; expires=Thu, 01-Jan-1970 00:00:01 GMT"; } }; Nabble.vars = ["appnotice"]; Nabble.pvars = ["tview"]; /* persistent */ (function(){ for(var i=0;i<Nabble.vars.length;i++) { var v = Nabble.vars[i]; Nabble[v] = Nabble.getCookie(v); } for(var i=0;i<Nabble.pvars.length;i++) { var v = Nabble.pvars[i]; Nabble[v] = Nabble.getCookie(v); } })(); Nabble.handleVars = function() { for( var i=0; i<Nabble.vars.length; i++ ) { var v = Nabble.vars[i]; if( Nabble[v] != Nabble.getCookie(v) ) { Nabble.setVar(v,Nabble[v]); } } for( var i=0; i<Nabble.pvars.length; i++ ) { var v = Nabble.pvars[i]; if( Nabble[v] != Nabble.getCookie(v) ) { Nabble.setVar(v,this[v]); } } }; Nabble.contains = function(a,v) { for( var i=0; i<a.length; i++ ) { if( a[i]==v ) return true; } return false; }; Nabble.setVar = function(v,val) { Nabble[v] = val; try { Nabble.getParent().Nabble[v] = val; } catch(err) {} if(val) { if( this.contains(this.vars,v) ) { this.setCookie(v,val); } else if( this.contains(this.pvars,v) ) { this.setPersistentCookie(v,val); } else { throw new Error("var not found: "+v); } } else { this.deleteCookie(v); } }; Nabble.toggle = function(id, callback) { $('#'+id).slideToggle('slow', function(){ if (callback) callback(); Nabble.resizeFrames(); }); }; Nabble.trim = function(s) { return s.replace(/^\s+|\s+$/g,''); }; /* overridden in javascript_library macro */ Nabble.getClientID = function(){}; Nabble.newCaptcha = function() { var img = Nabble.get("nabble-captcha"); img.src = "/util/Captcha.jtp?_="+Math.random() + Nabble.getClientID(); }; var userHeaderListeners = []; var userHeaderReady = false; Nabble.addUserHeaderListener = function(listener){ if (!userHeaderReady) userHeaderListeners.push(listener); else listener(); }; Nabble.userHeader = function() { $(document).ready(function(){ var s = ''; if (Nabble.siteHeader) s += Nabble.siteHeader(); $("#nabble-user-header").html(s); for(var i=0;i<userHeaderListeners.length;i++) userHeaderListeners[i](); userHeaderReady = true; }); }; function notice(s, wait, fade) { var $n = $('#notice'); $n.html(s); var hw = $n.width()/2; $n.css('margin-left', -hw + 'px'); $n.show(); if (wait && fade) setTimeout(function() { $n.fadeOut(fade); }, wait); }; function singleSubmit(f) { if (f.done) return false; f.done = true; return true; }; Nabble.analytics = function() { if (navigator.cookieEnabled && !Nabble.getCookie("v")) { var visitCounter = "/util/VisitCounter.jtp?referrer=" + encodeURIComponent(document.referrer); Nabble.loadScript(visitCounter); } var expires = new Date(); expires.setTime(expires.getTime()+30*60*1000); document.cookie = "v=x; expires=" + expires.toGMTString() + "; path=/"; }; var host = "apache-spark-user-list.1001560.n3.nabble.com"; Nabble.embeddingUrl = null; Nabble.embedForumID = 0; Nabble.isEmbedded = false; Nabble.clientID = ''; try { var info = Nabble.getParent().nabbleinfo.location.search.substring(6); info = decodeURIComponent(info); var pos = info.indexOf('&'); Nabble.embedForumID = info.substring(0, pos); Nabble.clientID = info.substring(pos+5, info.indexOf('&cookies')); var hash = Nabble.getParent().nabbleinfo.location.hash.substring(1).split('|'); Nabble.embeddingUrl = hash[0]; Nabble.isEmbedded = true; } catch(err) {} Nabble.getClientID = function(c) { if (Nabble.getParent().nabbleinfo && !Nabble.getParent().nabbleinfo.cookiesEnabled) return (c?c:'&') + 'cid=' + Nabble.getParent().nabbleinfo.clientID; return ''; }; Nabble.embeddedTarget = function(defaultTarget) { return Nabble.isEmbedded? ' target="nabbleiframe" ' : ' target="' + defaultTarget + '" '; }; Nabble.height = function() { if( typeof( window.innerHeight ) == 'number' ) { return window.innerHeight; } else if( document.documentElement && document.documentElement.clientHeight ) { return document.documentElement.clientHeight; } else if( document.body && document.body.clientHeight ) { return document.body.clientHeight; } }; Nabble.knowsHeight = navigator.userAgent.toLowerCase().indexOf('safari') == -1; Nabble.canScroll = function() { try{ return Nabble.getParent().nabbleinfo.canScroll(); } catch(er) {} return true; }; Nabble.hash = function() { var _hash = location.hash; if (Nabble.getParent().nabbleinfo && Nabble.getParent().nabbleinfo.hash) { if (!_hash) _hash = '#' + Nabble.getParent().nabbleinfo.hash; Nabble.getParent().nabbleinfo.hash = null; } return _hash; }; Nabble.fixCookieClientID = function() { Nabble.fixLinkClientID(); Nabble.fixFormClientID(); Nabble.fixImageClientID(); }; Nabble.fixLinkClientID = function(p) { if (Nabble.getParent().nabbleinfo && !Nabble.getParent().nabbleinfo.cookiesEnabled) { var $links = p? $('a,li',p) : $('a,li'); $links.each(function() { var href = $(this).attr('href'); if (href) { var isAnotherDomain = href.indexOf('http://') == 0 && href.indexOf('http://'+host) == -1; var isJs = href.indexOf('javascript:') == 0; var isMailto = href.indexOf('mailto:') == 0; if (isAnotherDomain || isJs || isMailto || href.charAt(0) == '#') return; $(this).attr('href', Nabble.appendClientID(href)); } }); } }; Nabble.appendClientID = function(url) { var hash = ''; var hashPos = url.indexOf('#'); if (hashPos > 0) { hash = url.substring(hashPos); url = url.substring(0, hashPos); } var c = url.lastIndexOf('?') == -1? (url.indexOf('.jtp') > 0? '?':';') : '&'; return url + c + 'cid=' + Nabble.getParent().nabbleinfo.clientID + hash; }; Nabble.fixFormClientID = function() { if (Nabble.getParent().nabbleinfo && !Nabble.getParent().nabbleinfo.cookiesEnabled) { $('form').each(function() { var $this = $(this); if ($this.attr('rel') == 'external') return; if ($this.attr('enctype') == 'multipart/form-data') { var a = $this.attr('action'); $this.attr('action', a + '?cid=' + Nabble.getParent().nabbleinfo.clientID); } else { var i = document.createElement("input"); $(i).attr('type','hidden'); $(i).attr('name','cid'); $(i).attr('value',Nabble.getParent().nabbleinfo.clientID); $this.prepend($(i)); } }); } }; Nabble.fixImageClientID = function() { if (Nabble.getParent().nabbleinfo && !Nabble.getParent().nabbleinfo.cookiesEnabled) { $('img[src*="/file/"]').each(function() { var src = $(this).attr('src'); if (src && src.indexOf(';cid=') == -1) { $(this).attr('src', Nabble.appendClientID(src)); } }); } }; Nabble.setTop = function(url) { if (Nabble.isEmbedded) Nabble.getParent().nabbleiframe.location=url; else top.location=url; }; Nabble.getMyHeight = function() { try { if ($.browser.msie) return document.body.scrollHeight; if ($.browser.mozilla) return document.body.offsetHeight; else if ($.browser.safari) return $('#nabble').height(); else return Math.max(document.body.scrollHeight, document.body.offsetHeight); } catch(err) {} return 500; }; Nabble.evalInTop = function(key, js) { var p = ''; for (var i = 0; i < js.length; i++) { p += 'v=' + key[i] + '|' + encodeURIComponent(js[i]) + '&'; } if (p.length > 0) { var url = "/util/SessionService$Attributes.jtp?action=set&" + p + "cid=" + Nabble.clientID + "&_=" + new Date().getTime(); $.get(url, function() { Nabble.getParent().nabbleresize.location = "/util/Empty.jtp"; }); } }; Nabble.quote = function(s) { return '"' + s.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"') + '"'; }; Nabble.heightLimit = 32767; Nabble.resizeCount = 0; Nabble.isValidHeight = function(height) { var isBadBrowser = $.browser.mozilla || $.browser.opera; var exceeded = height > Nabble.heightLimit && isBadBrowser; return !exceeded; }; Nabble.resizeFrames = function(h, scroll) { if (Nabble.getParent().nabbleresize) { var height = h && typeof h == 'number'? h : Math.max(Nabble.getMyHeight() + 25, 600); var validHeight = Nabble.isValidHeight(height); height = validHeight? height : Nabble.heightLimit; var js = [], key = []; if (scroll) { js.push("Nabble.scroll(" + scroll + ");"); key.push("scrolljs"); } if (height != $(window).height() || Nabble.resizeCount++ == 0) { js.push("Nabble.resizeFrames(" + height + "," + Nabble.quote(document.title) + "," + validHeight + ");"); key.push("resizejs"); } if (js.length > 0) Nabble.evalInTop(key, js); } }; Nabble.restartEmbedding = function(nodeId, baseUrl) { if (Nabble.getParent().nabbleresize) { var js = ['Nabble.restart(' + nodeId + ',"' + baseUrl + '");']; Nabble.evalInTop(['others'], js); } }; $(document).ready(function(){ if (Nabble.isEmbedded) { Nabble.resizeFrames('', 1); $(window).resize(Nabble.resizeFrames); $(window).load(function() { Nabble.resizeFrames(); }); } }); Nabble.online = function(id) { $('img.online'+id).show(); }; Nabble.openMsg = function(id) { return Nabble.getCookie(id) == null; }; Nabble.toggleMsg = function(id, hide) { if (hide) Nabble.setPersistentCookie(id, 'closed'); else Nabble.deleteCookie(id); }; Nabble.months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]; Nabble.now = new Date(); Nabble.fmt2 = function(i) { return i <= 9? '0'+i:i; }; Nabble.isToday = function(date) { return date.toDateString() == this.now.toDateString(); }; Nabble.isThisYear = function(date) { return date.getYear() == this.now.getYear(); }; Nabble.dateFormatters = { us: new (function(){ this.formatTime = function(date) { var hours = date.getHours(); if (hours < 12) { var xm = "am"; if (hours==0) hours = 12; } else { var xm = "pm"; if (hours > 12) hours -= 12; } return hours + ":" + Nabble.fmt2(date.getMinutes()) + xm; }; this.formatDateOnly = function(date) { return Nabble.months[date.getMonth()] + " " + Nabble.fmt2(date.getDate()) + ", " + date.getFullYear(); }; this.formatDateLong = function(date) { return this.formatDateOnly(date) + "; " + this.formatTime(date); }; this.formatDateShort = function(date) { if( Nabble.isToday(date) ) return this.formatTime(date); if( Nabble.isThisYear(date) ) return Nabble.months[date.getMonth()] + " " + Nabble.fmt2(date.getDate()); return this.formatDateOnly(date); }; })() , euro: new (function(){ this.formatTime = function(date) { return Nabble.fmt2(date.getHours()) + ":" + Nabble.fmt2(date.getMinutes()); }; this.formatDateOnly = function(date) { return Nabble.fmt2(date.getDate()) + "." + Nabble.months[date.getMonth()] + "." + date.getFullYear(); }; this.formatDateLong = function(date) { return this.formatTime(date) + ", " + this.formatDateOnly(date); }; this.formatDateShort = function(date) { if( Nabble.isToday(date) ) return this.formatTime(date); if( Nabble.isThisYear(date) ) return Nabble.fmt2(date.getDate()) + "." + Nabble.months[date.getMonth()]; return this.formatDateOnly(date); }; })() , tech: new (function(){ this.formatTime = function(date) { return Nabble.fmt2(date.getHours()) + ":" + Nabble.fmt2(date.getMinutes()); }; this.formatDateOnly = function(date) { return "" + date.getFullYear() + "-" + Nabble.fmt2(date.getMonth()+1) + "-" + Nabble.fmt2(date.getDate()) }; this.formatDateLong = function(date) { return this.formatDateOnly(date) + " " + this.formatTime(date); }; this.formatDateShort = function(date) { if( Nabble.isToday(date) ) return this.formatTime(date); if( Nabble.isThisYear(date) ) return Nabble.fmt2(date.getMonth()+1) + "-" + Nabble.fmt2(date.getDate()); return this.formatDateOnly(date); }; })() }; Nabble.getDateFmt = function() { var dateFmt = Nabble.getCookie("date_fmt"); return dateFmt==null ? "us" : dateFmt; }; Nabble.formatDateOnly = function(date) { return Nabble.dateFormatters[Nabble.getDateFmt()].formatDateOnly(date); }; Nabble.formatTimeOnly = function(date) { return Nabble.dateFormatters[Nabble.getDateFmt()].formatTime(date); }; Nabble.formatDateLong = function(date) { return Nabble.dateFormatters[Nabble.getDateFmt()].formatDateLong(date); }; Nabble.formatDateShort = function(date) { var fmt = Nabble.dateFormatters[Nabble.getDateFmt()]; return '<span title="' + fmt.formatDateLong(date) + '">' + fmt.formatDateShort(date) + '</span>'; }; var t_login = "Login"; var t_register = "Register"; var t_logout = "Log out"; var t_my_posts = "My posts"; var t_account_settings = "Account settings"; var t_show_nabble_notice = "Show Nabble notice"; var t_permalink = "Permalink"; var t_refresh = "Refresh"; var login_path = "/template/NamlServlet.jtp?macro=login_page"; var logout_path = "/template/NamlServlet.jtp?macro=logout_page"; var register_path = "/template/NamlServlet.jtp?macro=start_registration_page"; var user_profile_path = "/template/NamlServlet.jtp?macro=user_profile"; Nabble.userId = Nabble.getCookie("userId"); var encodedUsername = Nabble.getCookie("username"); if (encodedUsername) { Nabble.username = decodeURIComponent(encodedUsername) .replace(new RegExp('\\+','g'),' '); } if (!Nabble.userId) { Nabble.anonymousId = Nabble.getCookie("anonymousId"); var encodedName = Nabble.getCookie("anonymousName"); if (encodedName) { Nabble.anonymousName = decodeURIComponent(encodedName) .replace(new RegExp('\\+','g'),' ') .replace(new RegExp('<','g'),'&lt;') .replace(new RegExp('>','g'),'&gt;'); } } Nabble.embedPermalink = function(url) { if (!Nabble.isEmbedded) return url; return url.replace(/(;|&)cid=(\d|\-)+/g, '').replace(/\?cid=(\d|\-)+(&)?/g, '?'); }; Nabble.getPermalink = function() { return Nabble.embedPermalink( Nabble.overridePermalink? Nabble.overridePermalink : Nabble.getParent().nabbleiframe.location.href); }; Nabble.permalinkLabel = function() { if (!Nabble.isEmbedded) return ''; var p = "<script>function openPermalink() { prompt('Copy this:', Nabble.getPermalink()); };</script>"; p += "<a href='javascript: void openPermalink();'>"+t_permalink+"</a>&nbsp;&nbsp;"; return p; }; Nabble.refreshLabel = function() { if (Nabble.isEmbedded) return "<a href='javascript: location.reload(true);'>"+t_refresh+"</a>&nbsp;&nbsp;"; return ''; }; Nabble.siteHeader = function() { var s = Nabble.refreshLabel(); s += Nabble.permalinkLabel(); if (!Nabble.userId) { var nextUrl = typeof loginNextUrl == 'undefined'? window.location.href : loginNextUrl; s += '<a href="'+login_path+'&nextUrl='+encodeURIComponent(nextUrl)+'">'+t_login+'</a>'; s += '&nbsp;&nbsp;'; s += '<a href="'+register_path+'&nextUrl='+encodeURIComponent(nextUrl)+'">'+t_register+'</a>'; if (Nabble.anonymousId && Nabble.anonymousName) { s += '&nbsp;&nbsp;'; s += '<a href="/template/NamlServlet.jtp?macro=user_nodes&user=' + Nabble.anonymousId + '~' + Nabble.anonymousName + '">'; s += Nabble.anonymousName; s += '</a>'; } } else s += '<span id="user-dd"></span>'; return s; }; Nabble.userDropdown = function() { var $t = $('#user-dd'); if ($t.size() == 0) return; $t.empty(); var dropdown = new NabbleDropdown('usrdd', Nabble.escapeHTML(Nabble.username)); dropdown.add('myPosts','<a href="/template/NamlServlet.jtp?macro=user_nodes&user='+Nabble.userId + '">'+t_my_posts+'</a>'); dropdown.add('personalSettings','<a href="'+user_profile_path+'">'+t_account_settings+'</a>'); dropdown.add('adminNotice','<a href="javascript: void Nabble.showAdminNotice()">'+t_show_nabble_notice+'</a>','display:none'); dropdown.add('logout','<a href="javascript: void Nabble.logout()">'+t_logout+'</a>'); $t.html(dropdown.getHtml()); dropdownInit('usrdd'); }; Nabble.addUserHeaderListener(function() { Nabble.userDropdown(); }); Nabble.showAdminNotice = function() { Nabble.deleteCookie('admin-notice'); window.location.reload(); }; Nabble.logout = function() { window.location = '/template/NamlServlet.jtp?macro=logout_page' + Nabble.getClientID(); }; var t_confirm_delete_post = "Do you really want to delete this post?"; var t_confirm_delete_post_recursively = "Do you really want to permanently delete this message and all replies?"; var t_caution_cannot_revert = "CAUTION: this action cannot be reverted."; Nabble.deletePost = function(postId) { if (!confirm(t_confirm_delete_post)) return; var newLocation = "/template/NamlServlet.jtp?macro=delete_post&node="+postId+Nabble.getClientID(); Nabble.setTop(newLocation); }; Nabble.deleteFromSite = function(nodeId) { if( !confirm(t_confirm_delete_post_recursively+"\n\n"+t_caution_cannot_revert) ) return; var newLocation = "/template/NamlServlet.jtp?macro=delete_from_site&node="+nodeId+Nabble.getClientID(); Nabble.setTop(newLocation); }; Nabble.messageTextWidth = function() { var maxWidth = Nabble.getCookie("max_width"); if( maxWidth==null ) return; document.write("<style type='text/css'>.nabble .message-text {max-width: "+maxWidth+";}</style>"); }; Nabble.setFontSize = function() { var fontSize = Nabble.getCookie("font_size"); if (fontSize) document.write("<style type='text/css'>body, table .nabble {font-size: "+fontSize+";}</style>"); }; Nabble.fixTopicLinks = function() { if (Nabble.tview == "classic") return; var a = Nabble.get("nabble").getElementsByTagName("a"); for (var i=0; i<a.length; i++) { var tag = a[i]; var threadHref = tag.getAttribute("threaded_href"); var listHref = tag.getAttribute("list_href"); if (threadHref && Nabble.tview == "threaded") { tag.href = threadHref; } else if (listHref && Nabble.tview == "list") { tag.href = listHref; } } }; var quotedLinesToHide = 10; Nabble.hideQuotes = function(context) { $('div.shrinkable-quote',context).after( "<div class='shrink-quote'><span></span> [<a href='#'></a>]</div>" ); $('div.shrink-quote a', context) .toggle(function(){ var $this = $(this); $this.prev().html( "..." ); $this.html( "show rest of quote" ); var $text = $this.parent().prev(); $text.css('height', quotedLinesToHide * $this.parent().height() ); $text.css('overflowY', 'hidden' ); Nabble.resizeFrames(); }, function(){ var $this = $(this); $this.prev().html( "&#171;&nbsp;" ); $this.html( "hide part of quote" ); var $text = $this.parent().prev(); $text.css( 'height', 'auto' ); $text.css( 'overflowY', 'auto' ); Nabble.resizeFrames(); }) .click() ; }; Nabble.highlightSearchTerms = function(searchterms, elem) { if (elem.childNodes && elem.childNodes.length > 0) { for (var i=0; i<elem.childNodes.length; i++) { this.highlightSearchTerms(searchterms, elem.childNodes[i]); } } else if (elem.nodeType) { if (elem.nodeType == document.TEXT_NODE || elem.nodeType == 3) { var txt = elem.nodeValue; var rgx = new RegExp("\\b("+searchterms+")\\w*\\b", "gi"); var result; var start = 0; var newFragment = document.createElement("span"); while ((result = rgx.exec(txt)) != null) { var end = result.index; var textNode = document.createTextNode(txt.slice(start, end)); newFragment.appendChild(textNode); var hlNode = document.createElement("span"); hlNode.className = "bold highlight search-highlight"; hlNode.appendChild(document.createTextNode(result[0])); newFragment.appendChild(hlNode); start = end + result[0].length; Nabble.hasHighlightedTerms = true; } newFragment.appendChild(document.createTextNode(txt.slice(start))); elem.parentNode.replaceChild(newFragment, elem); } } }; Nabble.getSearchTerms = function() { var searchterms = this.getCookie("searchterms"); if (document.referrer) { var result = Nabble.getSearchTerms2(document.referrer); if (result!=null) { var query = decodeURIComponent(result); searchterms = query.replace(/\W+/g,"|").replace(/^\|/,"").replace(/\|$/,""); this.setCookie("searchterms", searchterms); Nabble.gquery = query.replace(/\+/g," "); } } return searchterms; }; /* Logic from _uOrg() in urchin.js */ Nabble.getSearchTerms2 = function(referrer) { if (typeof(_uOsr)=="undefined" || typeof(_uOkw)=="undefined") return null; var searchEngines = _uOsr; /* from urchin */ var searchQueries = _uOkw; /* from urchin */ var i; if (referrer==null || (i=referrer.indexOf("://")) < 0) return null; var h = referrer.substring(i+3); var p = h.indexOf("/"); if (p > -1) h = h.substring(0,p); for (var j=0; j<searchEngines.length; j++) { var engine = searchEngines[j]; var query = searchQueries[j]; if (h.toLowerCase().indexOf(engine.toLowerCase()) > -1) { if ((i=referrer.indexOf("?"+query+"=")) > -1 || (i=referrer.indexOf("&"+query+"=")) > -1) { var k = referrer.substring(i+query.length+2,referrer.length); if ((i=k.indexOf("&")) > -1) k = k.substring(0,i); return k; } } } return null; };
	var _gaq = _gaq || []; var isA; (function() { var ab = Nabble.getCookie("ab"); if( ab == null ) { ab = Math.random() < 0.5 ? "a" : "b"; Nabble.setCookie("ab",ab); } isA = ab == "a"; })(); var isB = !isA; Nabble.isSafe = true; Nabble.adGroup = 'SAFE'; var lastDayWithoutAds = 1403135684091; var daysLeft = Math.round((lastDayWithoutAds - new Date().getTime()) / (24 * 60 * 60 * 1000)); Nabble.currentCredits = 0; Nabble.creditsForUsersOnly = false; Nabble.wasCreatedRecently = daysLeft > 0; Nabble.showDaysLeft = true; Nabble.buyCreditsPath = '/template/NamlServlet.jtp?macro=buy_credits_page'; Nabble.noAds = function(location) { Nabble.noAds = function(location) {}; _gaq.push(['nabble._trackEvent', 'ad-type', 'NONE']); }; Nabble.ads = function(location) { if (Nabble.currentCredits > 0 && Nabble.creditsForUsersOnly && Nabble.userId) return; Nabble.fixAdGroup(location); Ads[Nabble.adGroup](location); }; Nabble.adbayes = function() { window.Adbayes = window.Adbayes || { properties:{} }; Adbayes.properties['domain'] = window.location.hostname; Adbayes.properties['adtype'] = Nabble.adGroup; if (Nabble.wasCreatedRecently) Nabble.adGroup = "NEW"; if( Nabble.adGroup=='SAFE' && Adbayes.result != 'safe' ) Nabble.adGroup = 'UNSAFE'; if( Nabble.adGroup=='SAFE' ) _gaq.push(['nabble._setCustomVar', 1, 'Safe', 'x']); }; Nabble.fixAdGroup = function(location) { Nabble.fixAdGroup = function(location) {}; if (!window.Adbayes) { Nabble.adGroup = "NABBLE"; _gaq.push(['nabble._trackEvent', 'ad-type', Nabble.adGroup]); return; } switch(location) { case 'app_bottom': Adbayes.properties['page-type'] = 'forum'; break; case 'first_classic_message': case 'last_classic_message': Adbayes.properties['page-type'] = 'classic-view'; break; case 'list_bottom': Adbayes.properties['page-type'] = 'list-view'; break; case 'threaded_bottom': Adbayes.properties['page-type'] = 'threaded-view'; break; case 'blog_topic': Adbayes.properties['page-type'] = 'blog-topic'; break; case 'search_top': case 'search_bottom': Adbayes.properties['page-type'] = 'search'; break; case 'widget': Adbayes.properties['page-type'] = 'widget'; break; default: Adbayes.properties['page-type'] = 'unknown:' + location; break; } Nabble.realTimeAnalytics(); }; Nabble.realTimeAnalytics = function() { _gaq.push(['nabble._trackEvent', 'ad-type', Nabble.adGroup]); if (Adbayes.properties['adtype'] == 'SAFE' && window.Adbayes.listeners) { window.Adbayes.listeners.push(function() { var page = Adbayes.properties['page-type']; var status; if (Adbayes.isNew) { status = "new"; } else if (Adbayes.isCanonical) { status = "canonical"; } else if(Adbayes.isOutdated) { status = "outdated"; } else { status = "set"; } _gaq.push(['nabble._trackEvent', 'adbayes-status', page + ':' + status, Adbayes.result]); }); } }; var Ads = {}; Ads.styles = { widget: { cls: '', style: '' }, blog_topic: { cls: 'shaded-bg-color rounded', style: 'padding:.5em;' }, first_classic_message: { cls: '', style: 'text-align:left;' }, last_classic_message: { cls: '', style: 'text-align:left;padding-top:1em;' }, list_bottom: { cls: '', style: 'margin-top:1.5em;' }, threaded_bottom: { cls: '', style: 'margin-top:1.5em;' }, search_top: { cls: '', style: 'text-align:left;margin:1em 0;padding:.5em 0;' }, search_bottom: { cls: '', style: 'text-align:left;padding:.5em 0;' }, app_bottom: { cls: '', style: 'margin:2.5em auto;text-align:center;' }, topic_bottom: { cls: '', style: '' } }; Ads.NEW = function(location) { switch(location) { case 'blog_topic': case 'first_classic_message': case 'list_bottom': case 'threaded_bottom': case 'search_bottom': case 'app_bottom': } }; Ads.NABBLE = function(location) { switch(location) { case 'blog_topic': case 'first_classic_message': case 'list_bottom': case 'threaded_bottom': case 'search_bottom': Nabble.showAd( location, function() { var imgName = 'ad_nabble.png'; var url = 'http://www.nabble.com/'; _gaq.push(['nabble._trackEvent', 'banner', imgName]); document.write('<a href="'+url+'" rel="nofollow" style="display:block !important;visibility:visible !important;height:auto !important; width: auto !important;position:static !important;top:auto !important;left:auto !important"><img src="http://static.nabble.com/images/'+imgName+'" style="border:1px solid #bbb;display:inline !important;visibility:visible !important;height:auto !important;width:auto !important"/></a>'); } ); } }; Ads.AdSense = function(location) { switch(location) { case 'blog_topic': Nabble.showAd( location, function() { google_ad_slot = "8807592501"; google_ad_width = 728; google_ad_height = 90; Nabble._adsense(); } ); break; case 'first_classic_message': Nabble.showAd( location, function() { var fn = function() { google_ad_slot = "8703015991"; google_ad_width = 336; google_ad_height = 280; Nabble._adsense(); }; document.writeln('<div style="width:336px; float:left; clear:none; display:block !important;">'); Nabble.writeFn(fn); document.writeln('</div>'); document.writeln('<div style="width:336px; float:left; clear:none; display:block !important;">'); Nabble.writeFn(fn); document.writeln('</div>'); }, "width:675px !important;" ); break; case 'last_classic_message': Nabble.showAd( location, function() { google_ad_slot = "8323336297"; google_ad_width = 728; google_ad_height = 90; Nabble._adsense(); } ); break; case 'list_bottom': Nabble.showAd( location, function() { google_ad_slot = "6508328921"; google_ad_width = 728; google_ad_height = 90; Nabble._adsense(); } ); break; case 'threaded_bottom': Nabble.showAd( location, function() { google_ad_slot = "8434893994"; google_ad_width = 728; google_ad_height = 90; Nabble._adsense(); } ); break; case 'search_top': Nabble.AdsenseSearchAds(); break; case 'search_bottom': Nabble.showAd( location, function() { google_ad_slot = "0099567777"; google_ad_width = 728; google_ad_height = 90; google_ad_type = "image"; Nabble._adsense(); } ); break; case 'app_bottom': Nabble.showAd( location, function() { if (window.has_more_ads) { var fn = function() { google_ad_slot = "8703015991"; google_ad_width = 336; google_ad_height = 280; Nabble._adsense(); }; document.writeln('<div style="width:336px; display:inline !important">'); Nabble.writeFn(fn); document.writeln('</div>'); document.writeln('<div style="width:336px; display:inline !important">'); Nabble.writeFn(fn); document.writeln('</div>'); document.writeln('<div style="width:336px; display:inline !important">'); Nabble.writeFn(fn); document.writeln('</div>'); } else { var fn = function() { google_ad_slot = "1057993213"; google_ad_width = 728; google_ad_height = 90; Nabble._adsense(); }; Nabble.writeFn(fn); } } ); break; } }; Ads.SAFE = function(location) { Ads.AdSense(location); }; Ads.BAD = Ads.NABBLE; Ads.UNSAFE = Ads.NABBLE; Nabble.showAd = function(location,fn,style) { var customStyle = Ads.styles[location].style + (style == null?'':style); document.writeln('<div class="ad '+Ads.styles[location].cls+'" style="display:block !important;visibility:visible !important;height:auto !important; width: auto !important;position:static !important;top:auto !important;left:auto !important;'+customStyle+'">'); fn(); if (!Nabble.creditsForUsersOnly || Nabble.userId) { document.writeln('<div style="padding-top:.3em;font-size:90%;clear:both"><a href="'+Nabble.buyCreditsPath+'">'+Ads.text.removeAds+'</a></div>'); document.writeln('</div>'); } }; Nabble.AdsenseSearchAds = function() { if (nabble_search_query && nabble_search_query != '') { (function(G,o,O,g,L,e){G[g]=G[g]||function(){(G[g]['q']=G[g]['q']||[]).push( arguments)},G[g]['t']=1*new Date;L=o.createElement(O),e=o.getElementsByTagName( O)[0];L.async=1;L.src='//www.google.com/adsense/search/async-ads.js'; e.parentNode.insertBefore(L,e)})(window,document,'script','_googCsa'); document.writeln('<div id="ad1" style="margin:0 0 1em -.3em"></div>'); var pageOptions = { 'pubId': 'pub-6703598369329977', 'query': nabble_search_query, 'hl': 'en' }; var ad = Nabble._ad(); var bg = '#'+Nabble._bgcolor(ad); var tc = '#'+Nabble._color('div.search-results-header','808080'); var lc = '#'+Nabble._linkColor(ad); var adblock1 = { 'container': 'ad1', 'width': '100%', 'fontFamily': 'verdana', 'fontSizeTitle': 15, 'fontSizeDescription': 13, 'fontSizeDomainLink': 13, 'colorTitleLink': lc, 'colorText': tc, 'colorDomainLink': tc, 'colorBackground': bg, 'colorAdBorder': bg, 'colorBorder': bg }; _googCsa('ads', pageOptions, adblock1); } }; Nabble.writeFn = function(fn) { Nabble._fn = fn; document.writeln('<script type="text/javascript">Nabble._fn()</script>'); }; Nabble._adwords = function() { google_conversion_id = 975361083; google_conversion_language = "en"; google_conversion_format = "3"; google_conversion_color = "ffffff"; google_conversion_label = "sfP9CM34nwgQu6iL0QM"; google_conversion_value = 10; google_remarketing_only = false; document.write('<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script>'); }; Nabble._adsense = function() { var ad = Nabble._ad(); if( google_ad_width==728 && Nabble._narrowUnit(ad,728) ) { google_ad_slot = "1143776366"; google_ad_width = 468; google_ad_height = 60; } var bg = Nabble._bgcolor(ad); google_color_border = bg; google_color_bg = bg; google_color_text = "808080"; google_color_url = "808080"; google_color_link = Nabble._linkColor(ad); google_ad_client = "ca-pub-6703598369329977"; document.write('<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>'); var __ad = 'div'+ad.getAttribute('id').substring(2); $(ad).parent().addClass(__ad); document.write('<style type="text/css">'); document.write('.nabble .' + __ad + ' ins { display:inline-table !important; visibility: visible !important; height:' + google_ad_height + 'px !important; width: ' + google_ad_width + 'px !important; position:static !important;top:auto !important;left:auto !important; }'); document.write('.nabble .' + __ad + ' ins ins iframe { display:block !important; visibility: visible !important; height:' + google_ad_height + 'px !important; width: ' + google_ad_width + 'px !important; position:static !important;top:auto !important;left:auto !important; }'); document.write('</style>'); }; Nabble._ad = function() { var ad = "ad" + Math.round(Math.random() * 999999); document.writeln('<a id="'+ad+'" href="#" style="display:none">.</a>'); return Nabble.get(ad); }; Nabble._bgcolor = function(ad) { var $elem = $(ad); var $parent = $elem; var bg; while ($parent.size() > 0) { try { bg = $parent.css('background-color'); } catch(err) { $elem.addClass('shaded-bg-color'); bg = $elem.css('background-color'); break; } if (bg != 'transparent' && bg.indexOf('rgba') != 0) break; $parent = $parent.parent(); } if (bg.charAt(0) == '#') return bg.substring(1); else if (bg.indexOf('rgb') == 0) { bg = bg.substring(4, bg.length-1); var rgb = bg.split(','); return Nabble._hexa(rgb[0]) + Nabble._hexa(rgb[1]) + Nabble._hexa(rgb[2]); } return bg; }; Nabble._linkColor = function(ad) { var c = $(ad).css('color'); if (c.charAt(0) == '#') return c.substring(1); else if (c.indexOf('rgb') == 0) { c = c.substring(4, c.length-1); var rgb = c.split(','); return Nabble._hexa(rgb[0]) + Nabble._hexa(rgb[1]) + Nabble._hexa(rgb[2]); } return 'EEEEEE'; }; Nabble._color = function(sel,def) { var c = $(sel).css('color'); if (c.charAt(0) == '#') return c.substring(1); else if (c.indexOf('rgb') == 0) { c = c.substring(4, c.length-1); var rgb = c.split(','); return Nabble._hexa(rgb[0]) + Nabble._hexa(rgb[1]) + Nabble._hexa(rgb[2]); } return def; }; Nabble._hexa = function(c) { var n = parseInt(c).toString(16); return n.length == 1? '0' + n : n; }; Nabble._narrowUnit = function(ad,limit) { return $(ad).parent().width() < limit; }; var b = function() {}; if(isB) b();
	
	Nabble.vote = function(nodeId,maxChoices) { var vote_count = $('#poll_form'+nodeId+' input:checked').length; if (vote_count > maxChoices) { alert('Please select no more than '+maxChoices+' options.'); return false; } else if (vote_count == 0) { alert('Please select at least one option.'); return false; } var params = $('#poll_form'+nodeId).serialize(); var call = '/template/NamlServlet.jtp?macro=vote&'+params+Nabble.getClientID(); var call2 = '/template/NamlServlet.jtp?macro=poll_js&poll_node_id='+nodeId+Nabble.getClientID(); $.getScript(call, function() { notice('Your vote has been submitted.', 5000, 2000); $.getScript(call2); }); return false; };